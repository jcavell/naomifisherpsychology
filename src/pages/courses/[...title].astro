---
import getCourses from "../../scripts/courses";
import { makeUrl } from "../../scripts/url";
import CardLayout from "../../layouts/CardLayout.astro";
import CourseDetails from "../../components/CourseDetails.astro";

export async function getStaticPaths() {
  const courses = await getCourses();

  return courses.map((course) => (
  {
    params: { title: makeUrl(course.data.title)},
    props: {
      course: course,
      related: courses.filter((other) => 
        course.data.checkoutUrl != other.data.checkoutUrl &&
        other.data.tags?.includes(course.data.tags[0])
      ) },
  }
));
}  

const { course, related } = Astro.props;
---

<CardLayout pageTitle={course.data.title}>
  <CourseDetails
    price={course.data.price}
    imageFileName={course.data.imageFileName}
    checkoutURL={course.data.checkoutUrl}
    title={course.data.title}
    summary={course.data.description}
    descriptions={course.data.checkout?.descriptions}
    testimonials={course.data.checkout?.testimonials}
    people={course.data.people}
    tags={course.data.tags}
    related={related}
  />
</CardLayout>
