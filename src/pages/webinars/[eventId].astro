---
import getWebinars from "../../scripts/webinars";
import type { EventbriteWebinar } from "../../scripts/webinars"; // Import the EventbriteWebinar type

import { makeUrl } from "../../scripts/url";
import WebinarDetails from "../../components/webinar/WebinarDetails.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getWebinarMeta } from "../../scripts/webinarMeta";

export async function getStaticPaths() {
  const webinars = await getWebinars();

  return webinars.map((webinar: Webinar) => {
    // Use the EventbriteWebinar type here
    return {
      params: { eventId: makeUrl(webinar.id) },
      props: {
        webinar: webinar,
      },
    };
  });
}

// Add the EventbriteWebinar type for the `webinar` being used in Astro.props
const { webinar }: { webinar: Webinar } = Astro.props;

const eventId: string = webinar.id; // Use the correct type
const meta = getWebinarMeta(eventId);

// Add proper typing for metaDescription
const metaDescription: string =
  "Dr Naomi Fisher's webinar: " +
  webinar.name.text +
  ". " +
  webinar.description.text +
  " " +
  meta?.tags.map((t) => "#" + makeUrl(t)).join(" ");
---

<BaseLayout
  active="webinars"
  pageTitle={webinar.name.text}
  metaDescription={metaDescription}
>
  <WebinarDetails webinar={webinar} />
</BaseLayout>
